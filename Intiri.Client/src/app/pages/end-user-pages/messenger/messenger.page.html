<ion-content>
  <div id="home">
    <app-header *ngIf="loggedUser?.roles[0] === 'FreeEndUser'"></app-header>
    <app-header-admin *ngIf="loggedUser?.roles[0] === 'Admin'"></app-header-admin>
    <app-header-internal-designer *ngIf="loggedUser?.roles[0] === 'InternalDesigner'"></app-header-internal-designer>
    <ion-grid class="main-container">
      <ion-row>
        <ion-col size="12" size-sm="10" offset-sm="1" offset-xl="0" size-xl="4">
          <h1 class="main-title">Messages</h1>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col size="12" size-sm="10" offset-sm="1" offset-xl="0" size-xl="3.2">
            <div class=" xl-ion:h-[720px] pb-8">
              <div class="mb-2">
                <span class="text-sm text-black-2">Search</span>
                <ion-input type="text" class="border rounded-2xl border-black-2 h-[52px]"></ion-input>
              </div>
              <ul>
                <li *ngFor="let user of contacts">
                  <div [class.bg-light]="activeChatUser.id === user.id" class="py-3 mb-1 px-2 rounded-md hover:bg-light flex justify-between cursor-pointer" (click)="changeChat(user)">
                    <div class="flex" >
                      <img [src]="user.photoPath ? user.photoPath : '../../../assets/images/profile-img.png'" class="w-[57px] h-[57px] rounded-lg object-cover" alt="Profile Img"/>
                      <div class="ml-3.5 w-[170px]">
                        <p class="text-black-1 leading-5 font-semibold">{{user.firstName}} {{user.lastName}}</p>
                        <p class="text-black-3 size-[15px] leading-5 text-clamp">{{user.lastMessageContent}}</p>
                      </div>
                    </div>
                    <div>
                      <p class="text-black-3 size-[15px] leading-[14px]">{{parseDate(user.lastMessageDate)}}</p>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
        </ion-col>
        <ion-col size="12" size-sm="10" offset-sm="1" offset-xl="0.3" size-xl="8.5">
            <div class="bg-light xl-ion:h-[682px] rounded-lg text-center pb-8">
              <div class="flex py-[22px] pl-[18px] border-b border-secondary">
                <img [src]="activeChatUser.photoPath ? activeChatUser.photoPath : '../../../assets/images/profile-img.png'" class="w-[45px] h-[45px] rounded-lg object-cover" alt="Profile Img"/>
                <p class="text-black-1 leading-5 font-semibold ml-[13px] flex items-center">{{activeChatUser.firstName}} {{activeChatUser.lastName}}</p>
              </div>
              <div class="chat" id="chatbox">
                <div *ngFor="let msg of messages" [class]="getChatClassName(msg)">{{msg.content ? msg.content : msg.Content}}</div>
              </div>
              <div class="chat-input">
                <ion-input type="text" (keyup.enter)="!activeChatUser.chatPeriodExpired && sendMsg()" [disabled]="activeChatUser.chatPeriodExpired" [(ngModel)]="message" placeholder="Type a message..." class="border bg-transparent text-left h-[52px] rounded-2xl border-black-2 mx-[20px] w-[80%]"></ion-input>
                <ion-icon class="img-btn disabled" name="image"></ion-icon>
                <div class="send-btn-wrapper" [ngClass]="{'disabled': activeChatUser.chatPeriodExpired}" (click)="!activeChatUser.chatPeriodExpired && sendMsg()"><ion-icon class="send-btn" name="send-sharp"></ion-icon></div>
              </div>
            </div>
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>
</ion-content>
